#!/usr/bin/env bash

_tsd=/usr/local/bin/tsd

styler(){
    screen -dmLS styler_screen bash -c 'node app.js'

    inotifywait -e modify src/lib/styler/*.js | while read file;
    do
        echo "${file} modified"
        #echo "" > screenlog.0
        ## kill screen first
        screen -X -S `screen -list | grep styler_screen | awk '{print $1}'` quit
        ## start new screen with serveprocesss
        bash run styler
    done
}

# ./run tsd install     # ./run tsd ts install     # ./run tsd lib install
# ./run tsd ts reinstall -o         # etc.
tsd(){

    if [ -n "$1" ]; then
        if [ "$1" == "lib" ]; then
            shift
            $_tsd $* --config tsd.lib.json
        elif [ "$1" == "ts" ]; then
            shift
            $_tsd $* --config tsd.ts.json
        else
            $_tsd $* --config tsd.json
        fi
    fi
}

$*
